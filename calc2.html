<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix & Flip Project Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        .summary-card {
            transition: all 0.3s ease;
        }
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            background: #e2e8f0;
            border-radius: 5px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        .repair-item {
            transition: all 0.2s ease;
        }
        .repair-item:hover {
            background-color: #f8fafc;
        }
        .cost-total {
            background-color: #f0f9ff;
            border-top: 2px solid #3b82f6;
        }
        .editable-cost {
            border: 1px solid #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            min-width: 80px;
            text-align: right;
            
        }
        .editable-cost:focus {
            outline: none;
            border-color: #3b82f6;
            background-color: white;
        }
        
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-10 text-center">
            <h1 class="text-4xl font-bold text-blue-600 mb-2">Fix & Flip Calculator</h1>
            <p class="text-gray-600">Calculate your maximum purchase price, projected profits, and ROI for your next house flip</p>
        </header>

        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="flex border-b overflow-x-auto">
                <button class="tab-btn active py-4 px-6 font-medium text-gray-700" data-tab="project-details">
                    <i class="fas fa-home mr-2"></i>Project Details
                </button>
                <button class="tab-btn py-4 px-6 font-medium text-gray-700" data-tab="purchase-costs">
                    <i class="fas fa-dollar-sign mr-2"></i>Purchase Costs
                </button>
                <button class="tab-btn py-4 px-6 font-medium text-gray-700 " data-tab="holding-costs">
                    <i class="fas fa-clock mr-2"></i>Holding Costs
                </button>
                <button class="tab-btn py-4 px-6 font-medium text-gray-700 " data-tab="repair-costs">
                    <i class="fas fa-tools mr-2"></i>Repair Costs
                </button>
                <button class="tab-btn py-4 px-6 font-medium text-gray-700 " data-tab="results">
                    <i class="fas fa-chart-line mr-2"></i>Results
                </button>
            </div>

            <!-- Project Details Tab -->
            <div id="project-details" class="tab-content active p-6">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800">Project Information</h2>
                
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-gray-700 mb-2">After Repair Value (ARV)</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-600">$</span>
                            <input type="number" id="arv" class="w-full pl-8 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="250,000">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">Desired Profit Percentage</label>
                        <div class="flex items-center">
                            <input type="range" id="profit-percent" min="10" max="50" value="20" class="w-full mr-4">
                            <span id="profit-percent-value" class="text-blue-600 font-medium">20%</span>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">Purchase Method</label>
                    <div class="flex space-x-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="purchase-method" value="cash" checked class="h-5 w-5 text-blue-600">
                            <span class="ml-2 text-gray-700">Cash Purchase</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="purchase-method" value="loan" class="h-5 w-5 text-blue-600">
                            <span class="ml-2 text-gray-700">Financed Purchase</span>
                        </label>
                    </div>
                </div>
                
                <div id="loan-details" class="hidden bg-gray-50 p-4 rounded-lg mb-6">
                    <h3 class="text-lg font-medium mb-4 text-gray-800">Loan Details</h3>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 mb-1 text-sm">Loan Amount (%)</label>
                            <input type="number" id="loan-percent" class="w-full px-3 py-2 border rounded-lg" placeholder="70" value="70">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1 text-sm">Interest Rate (%)</label>
                            <input type="number" id="interest-rate" class="w-full px-3 py-2 border rounded-lg" placeholder="8" value="8">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1 text-sm">Loan Term (months)</label>
                            <input type="number" id="loan-term" class="w-full px-3 py-2 border rounded-lg" placeholder="12" value="12">
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-gray-700 mb-1 text-sm">Points (%)</label>
                            <input type="number" id="loan-points" class="w-full px-3 py-2 border rounded-lg" placeholder="2" value="2">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1 text-sm">Origination Fee ($)</label>
                            <input type="number" id="origination-fee" class="w-full px-3 py-2 border rounded-lg" placeholder="1000" value="1000">
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button class="next-tab bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Purchase Costs Tab -->
            <div id="purchase-costs" class="tab-content p-6">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800">Purchase Costs</h2>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-gray-700 mb-2">Purchase Closing Costs (%)</label>
                        <input type="number" id="purchase-closing" class="w-full px-4 py-2 border rounded-lg purchase-cost-input" placeholder="2" value="2">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">Title Insurance ($)</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-600">$</span>
                            <input type="number" id="title-insurance" class="w-full pl-8 pr-4 py-2 border rounded-lg purchase-cost-input" placeholder="1000" value="1000">
                        </div>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-gray-700 mb-2">Home Inspection ($)</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-600">$</span>
                            <input type="number" id="inspection" class="w-full pl-8 pr-4 py-2 border rounded-lg purchase-cost-input" placeholder="400" value="400">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">Appraisal ($)</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-600">$</span>
                            <input type="number" id="appraisal" class="w-full pl-8 pr-4 py-2 border rounded-lg purchase-cost-input" placeholder="500" value="500">
                        </div>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-gray-700 mb-2">Survey ($)</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-600">$</span>
                            <input type="number" id="survey" class="w-full pl-8 pr-4 py-2 border rounded-lg purchase-cost-input" placeholder="300" value="300">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">Other Purchase Costs ($)</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-600">$</span>
                            <input type="number" id="other-purchase" class="w-full pl-8 pr-4 py-2 border rounded-lg purchase-cost-input" placeholder="0" value="0">
                        </div>
                    </div>
                </div>
                
                <div class="cost-total p-4 rounded-lg mb-6 flex justify-between items-center">
                    <span class="font-medium text-gray-700">Total Purchase Costs:</span>
                    <span id="purchase-costs-total" class="text-xl font-bold text-blue-600">$0</span>
                </div>
                
                <div class="flex justify-between">
                    <button class="prev-tab bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <button class="next-tab bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Holding Costs Tab -->
            <div id="holding-costs" class="tab-content p-6">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800">Holding Costs</h2>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-gray-700 mb-2">Holding Period (months)</label>
                        <input type="number" id="holding-period" class="w-full px-4 py-2 border rounded-lg holding-cost-input" placeholder="6" value="6">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">Property Tax Rate (%)</label>
                        <input type="number" id="tax-rate" class="w-full px-4 py-2 border rounded-lg holding-cost-input" placeholder="1.2" value="1.2" step="0.1">
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-gray-700 mb-2">Insurance ($/month)</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-600">$</span>
                            <input type="number" id="insurance" class="w-full pl-8 pr-4 py-2 border rounded-lg holding-cost-input" placeholder="100" value="100">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">Utilities ($/month)</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-600">$</span>
                            <input type="number" id="utilities" class="w-full pl-8 pr-4 py-2 border rounded-lg holding-cost-input" placeholder="200" value="200">
                        </div>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-gray-700 mb-2">HOA Fees ($/month)</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-600">$</span>
                            <input type="number" id="hoa" class="w-full pl-8 pr-4 py-2 border rounded-lg holding-cost-input" placeholder="0" value="0">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">Other Holding Costs ($/month)</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-600">$</span>
                            <input type="number" id="other-holding" class="w-full pl-8 pr-4 py-2 border rounded-lg holding-cost-input" placeholder="0" value="0">
                        </div>
                    </div>
                </div>
                
                <div class="cost-total p-4 rounded-lg mb-6 flex justify-between items-center">
                    <span class="font-medium text-gray-700">Total Holding Costs:</span>
                    <span id="holding-costs-total" class="text-xl font-bold text-blue-600">$0</span>
                </div>
                
                <div class="flex justify-between">
                    <button class="prev-tab bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <button class="next-tab bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Repair Costs Tab -->
            <div id="repair-costs" class="tab-content p-6">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800">Repair Costs</h2>
                
                <div class="mb-6">
                    <div class="flex items-center mb-4">
                        <input type="text" id="new-repair" placeholder="Add repair item" class="flex-grow px-4 py-2 border rounded-l-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-600">$</span>
                            <input type="number" id="new-repair-cost" class="pl-8 pr-4 py-2 border-t border-b border-r" placeholder="Cost">
                        </div>
                        <button id="add-repair" class="bg-blue-600 text-white px-4 py-2 rounded-r-lg hover:bg-blue-700 transition">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    
                    <div id="repair-list" class="border rounded-lg overflow-hidden">
                        <!-- Repair items will be added here -->
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-gray-700 mb-2">Rehab Contingency (%)</label>
                        <input type="number" id="contingency" class="w-full px-4 py-2 border rounded-lg repair-cost-input" placeholder="10" value="10">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">Selling Closing Costs (%)</label>
                        <input type="number" id="selling-closing" class="w-full px-4 py-2 border rounded-lg" placeholder="6" value="6">
                    </div>
                </div>
                
                <div class="cost-total p-4 rounded-lg mb-6 flex justify-between items-center">
                    <span class="font-medium text-gray-700">Total Repair Costs:</span>
                    <span id="repair-costs-total" class="text-xl font-bold text-blue-600">$0</span>
                </div>
                
                <div class="flex justify-between">
                    <button class="prev-tab bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <button id="calculate-btn" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
                        Calculate <i class="fas fa-calculator ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Results Tab -->
            <div id="results" class="tab-content p-6">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800 inline-block ">Project Summary</h2>
                <button id="recalculate-btn" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition float-right">
                    Calculate <i class="fas fa-calculator ml-2"></i>
                </button>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <div class="summary-card bg-white p-4 rounded-lg shadow border border-gray-100">
                        <div class="text-gray-500 text-sm mb-1">Maximum Purchase Price</div>
                        <div id="max-price" class="text-2xl font-bold text-blue-600">$0</div>
                    </div>
                    
                    <div class="summary-card bg-white p-4 rounded-lg shadow border border-gray-100">
                        <div class="text-gray-500 text-sm mb-1">Total Project Cost</div>
                        <div id="total-cost" class="text-2xl font-bold text-blue-600">$0</div>
                    </div>
                    
                    <div class="summary-card bg-white p-4 rounded-lg shadow border border-gray-100">
                        <div class="text-gray-500 text-sm mb-1">Estimated Profit</div>
                        <div id="estimated-profit" class="text-2xl font-bold text-green-600">$0</div>
                    </div>
                    
                    <div class="summary-card bg-white p-4 rounded-lg shadow border border-gray-100">
                        <div class="text-gray-500 text-sm mb-1">ROI</div>
                        <div id="roi" class="text-2xl font-bold text-green-600">0%</div>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow border border-gray-100">
                        <h3 class="text-lg font-medium mb-4 text-gray-800">Cost Breakdown</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Purchase Price:</span>
                                <span id="purchase-price-breakdown" class="font-medium">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Purchase Costs:</span>
                                <span id="purchase-costs-breakdown" class="font-medium">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Loan Costs:</span>
                                <span id="loan-costs-breakdown" class="font-medium">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Repair Costs:</span>
                                <span id="repair-costs-breakdown" class="font-medium">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Holding Costs:</span>
                                <span id="holding-costs-breakdown" class="font-medium">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Selling Costs:</span>
                                <span id="selling-costs-breakdown" class="font-medium">$0</span>
                            </div>
                            <div class="border-t pt-3 mt-2">
                                <div class="flex justify-between font-semibold">
                                    <span>Total Cost:</span>
                                    <span id="total-cost-breakdown" class="text-blue-600">$0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow border border-gray-100">
                        <h3 class="text-lg font-medium mb-4 text-gray-800">Profit Analysis</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">After Repair Value:</span>
                                <span id="arv-breakdown" class="font-medium">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total Investment:</span>
                                <span id="total-investment" class="font-medium">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Profit Percentage:</span>
                                <span id="profit-percent-breakdown" class="font-medium">0%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Profit per Month:</span>
                                <span id="profit-per-month" class="font-medium">$0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Capital Needed:</span>
                                <span id="capital-needed" class="font-medium">$0</span>
                            </div>
                            <div class="border-t pt-3 mt-2">
                                <div class="flex justify-between font-semibold">
                                    <span>Net Profit:</span>
                                    <span id="net-profit" class="text-green-600">$0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow border border-gray-100 mb-8">
                    <h3 class="text-lg font-medium mb-4 text-gray-800">Detailed Calculations</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
                                </tr>
                            </thead>
                            <tbody id="detailed-calc" class="bg-white divide-y divide-gray-200">
                                <!-- Detailed calculations will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="flex justify-between">
                    <button class="prev-tab bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition" onclick="window.print()">
                        <i class="fas fa-print mr-2"></i> Print Report
                    </button>
                </div>
            </div>
        </div>
        
        <footer class="text-center text-gray-500 text-sm mt-12">
            <p>Fix & Flip Calculator &copy; 2023 | Designed for real estate investors</p>
        </footer>
    </div>

    <script>
        // Tab navigation
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });
        
        document.querySelectorAll('.next-tab').forEach(btn => {
            btn.addEventListener('click', () => {
                const currentTab = btn.closest('.tab-content').id;
                const tabs = Array.from(document.querySelectorAll('.tab-content'));
                const currentIndex = tabs.findIndex(tab => tab.id === currentTab);
                
                if (currentIndex < tabs.length - 1) {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tabs[currentIndex + 1].classList.add('active');
                    document.querySelector(`[data-tab="${tabs[currentIndex + 1].id}"]`).classList.add('active');
                }
            });
        });
        
        document.querySelectorAll('.prev-tab').forEach(btn => {
            btn.addEventListener('click', () => {
                const currentTab = btn.closest('.tab-content').id;
                const tabs = Array.from(document.querySelectorAll('.tab-content'));
                const currentIndex = tabs.findIndex(tab => tab.id === currentTab);
                
                if (currentIndex > 0) {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tabs[currentIndex - 1].classList.add('active');
                    document.querySelector(`[data-tab="${tabs[currentIndex - 1].id}"]`).classList.add('active');
                }
            });
        });
        
        // Toggle loan details
        document.querySelectorAll('input[name="purchase-method"]').forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.value === 'loan') {
                    document.getElementById('loan-details').classList.remove('hidden');
                } else {
                    document.getElementById('loan-details').classList.add('hidden');
                }
            });
        });
        
        // Profit percentage slider
        const profitSlider = document.getElementById('profit-percent');
        const profitValue = document.getElementById('profit-percent-value');
        
        profitSlider.addEventListener('input', () => {
            profitValue.textContent = `${profitSlider.value}%`;
        });
        
        // Repair costs management
        const repairList = document.getElementById('repair-list');
        const addRepairBtn = document.getElementById('add-repair');
        const newRepairInput = document.getElementById('new-repair');
        const newRepairCostInput = document.getElementById('new-repair-cost');
        
         // Auto-calculate totals for repair costs
         function updateRepairCostsTotal() {
            const repairItems = Array.from(document.querySelectorAll('.repair-item')).map(item => {
                const costElement = item.querySelector('.editable-cost');
                const cost = parseFloat(costElement.tagName === 'INPUT' ? costElement.value : costElement.textContent.replace('$', '')) || 0;
                return cost;
            });
        
            const totalRepairCost = repairItems.reduce((sum, cost) => sum + cost, 0);
            const contingencyPercent = parseFloat(document.getElementById('contingency').value) || 0;
            const totalWithContingency = totalRepairCost * (1 + contingencyPercent / 100);
        
            document.getElementById('repair-costs-total').textContent = `$${totalWithContingency.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
        }
        
        
        document.getElementById('repair-list').addEventListener('input', updateRepairCostsTotal);
        document.getElementById('repair-list').addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-repair')) {
                e.target.closest('.repair-item').remove();
                updateRepairCostsTotal();
            }
        });
        document.getElementById('contingency').addEventListener('input', updateRepairCostsTotal);
      
        
        function makeCostEditable(costElement) {
            const originalValue = costElement.textContent.replace('$', '');
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'text-gray-700 mr-4 editable-cost';
            input.value = originalValue;
        
            costElement.replaceWith(input);
        
            input.addEventListener('blur', () => {
                const value = parseFloat(input.value) || 0;
                const span = document.createElement('span');
                span.className = 'text-gray-700 mr-4 editable-cost';
                span.textContent = `$${value.toFixed(2)}`;
                input.replaceWith(span);
                span.addEventListener('click', () => makeCostEditable(span));
                updateRepairCostsTotal();
            });
        
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    input.blur();
                }
            });
        
            input.focus();
        }
        addRepairBtn.addEventListener('click', () => {
            const repairName = newRepairInput.value.trim();
            const repairCost = parseFloat(newRepairCostInput.value) || 0;
            
            if (repairName) {
                const repairItem = document.createElement('div');
                repairItem.className = 'repair-item flex justify-between items-center p-3 border-b last:border-b-0';
                repairItem.innerHTML = `
                    <span>${repairName}</span>
                    <div class="flex items-center">
                        <span class="text-gray-700 mr-4 editable-cost">$${repairCost.toFixed(2)}</span>
                        <button class="delete-repair text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
        
                document.getElementById('repair-list').appendChild(repairItem);
                document.getElementById('new-repair').value = '';
                document.getElementById('new-repair-cost').value = '';
        
                // Add delete functionality
                repairItem.querySelector('.delete-repair').addEventListener('click', () => {
                    repairItem.remove();
                    updateRepairCostsTotal();
                });
        
                // Make cost editable
                const costElement = repairItem.querySelector('.editable-cost');
                costElement.addEventListener('click', () => makeCostEditable(costElement));
        
                updateRepairCostsTotal();
            }
        });
        
        // Allow adding repair with Enter key
        newRepairInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addRepairBtn.click();
            }
        });
        
        newRepairCostInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addRepairBtn.click();
            }
        });
        
        // Auto-calculate totals for purchase costs
        function updatePurchaseCostsTotal() {
            const purchaseClosingPercent = parseFloat(document.getElementById('purchase-closing').value) || 0;
            const maxPrice = parseFloat(document.getElementById('arv').value) * 0.7 || 0; // Estimate for calculation
            const purchaseClosingCost = maxPrice * purchaseClosingPercent / 100;
            const titleInsurance = parseFloat(document.getElementById('title-insurance').value) || 0;
            const inspection = parseFloat(document.getElementById('inspection').value) || 0;
            const appraisal = parseFloat(document.getElementById('appraisal').value) || 0;
            const survey = parseFloat(document.getElementById('survey').value) || 0;
            const otherPurchase = parseFloat(document.getElementById('other-purchase').value) || 0;
            
            const total = purchaseClosingCost + titleInsurance + inspection + appraisal + survey + otherPurchase;
            document.getElementById('purchase-costs-total').textContent = `$${total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
        }
        
        document.querySelectorAll('.purchase-cost-input').forEach(input => {
            input.addEventListener('input', updatePurchaseCostsTotal);
        });
        
        // Auto-calculate totals for holding costs
        function updateHoldingCostsTotal() {
            const holdingPeriod = parseFloat(document.getElementById('holding-period').value) || 0;
            const taxRate = parseFloat(document.getElementById('tax-rate').value) || 0;
            const maxPrice = parseFloat(document.getElementById('arv').value) * 0.7 || 0; // Estimate for calculation
            const propertyTax = maxPrice * taxRate / 100 / 12 * holdingPeriod;
            const insurance = parseFloat(document.getElementById('insurance').value) || 0;
            const utilities = parseFloat(document.getElementById('utilities').value) || 0;
            const hoa = parseFloat(document.getElementById('hoa').value) || 0;
            const otherHolding = parseFloat(document.getElementById('other-holding').value) || 0;
            
            const total = propertyTax + (insurance + utilities + hoa + otherHolding) * holdingPeriod;
            document.getElementById('holding-costs-total').textContent = `$${total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
        }
        
        document.querySelectorAll('.holding-cost-input').forEach(input => {
            input.addEventListener('input', updateHoldingCostsTotal);
        });
        
       // Calculation function
        document.getElementById('calculate-btn').addEventListener('click', calculateFlip);
        document.getElementById('recalculate-btn').addEventListener('click', calculateFlip);
        
        function calculateFlip() {
            // Get all input values
            const arv = parseFloat(document.getElementById('arv').value) || 0;
            const profitPercent = parseFloat(document.getElementById('profit-percent').value) || 20;
            const purchaseMethod = document.querySelector('input[name="purchase-method"]:checked').value;
            
            // Purchase costs
            const purchaseClosingPercent = parseFloat(document.getElementById('purchase-closing').value) || 0;
            const titleInsurance = parseFloat(document.getElementById('title-insurance').value) || 0;
            const inspection = parseFloat(document.getElementById('inspection').value) || 0;
            const appraisal = parseFloat(document.getElementById('appraisal').value) || 0;
            const survey = parseFloat(document.getElementById('survey').value) || 0;
            const otherPurchase = parseFloat(document.getElementById('other-purchase').value) || 0;
            
            // Holding costs
            const holdingPeriod = parseFloat(document.getElementById('holding-period').value) || 0;
            const taxRate = parseFloat(document.getElementById('tax-rate').value) || 0;
            const insurance = parseFloat(document.getElementById('insurance').value) || 0;
            const utilities = parseFloat(document.getElementById('utilities').value) || 0;
            const hoa = parseFloat(document.getElementById('hoa').value) || 0;
            const otherHolding = parseFloat(document.getElementById('other-holding').value) || 0;
            
            // Loan details
            let loanPercent = 0;
            let interestRate = 0;
            let loanTerm = 0;
            let loanPoints = 0;
            let originationFee = 0;
            
            if (purchaseMethod === 'loan') {
                loanPercent = parseFloat(document.getElementById('loan-percent').value) || 0;
                interestRate = parseFloat(document.getElementById('interest-rate').value) || 0;
                loanTerm = parseFloat(document.getElementById('loan-term').value) || 0;
                loanPoints = parseFloat(document.getElementById('loan-points').value) || 0;
                originationFee = parseFloat(document.getElementById('origination-fee').value) || 0;
            }
            
            // Repair costs
            const repairItems = Array.from(document.querySelectorAll('.repair-item')).map(item => {
                const name = item.querySelector('span:first-child').textContent;
                const cost = parseFloat(item.querySelector('.editable-cost').textContent.replace('$', '')) || 0;
                return { name, cost };
            });
            
            const totalRepairCost = repairItems.reduce((sum, item) => sum + item.cost, 0);
            const contingencyPercent = parseFloat(document.getElementById('contingency').value) || 0;
            const sellingClosingPercent = parseFloat(document.getElementById('selling-closing').value) || 0;
            
            // Calculate maximum purchase price using the 70% rule (simplified)
            // Max Price = ARV * (1 - Profit%) - Repair Costs - Holding Costs - Selling Costs
            // This is an iterative calculation since some costs depend on purchase price
            
            // Initial estimate
            let maxPrice = arv * (1 - profitPercent/100) - totalRepairCost * (1 + contingencyPercent/100);
            
            // Refine estimate by accounting for costs that depend on purchase price
            // We'll do a few iterations to get a better estimate
            for (let i = 0; i < 5; i++) {
                // Calculate costs that depend on purchase price
                const purchaseClosingCost = maxPrice * purchaseClosingPercent / 100;
                const propertyTax = maxPrice * taxRate / 100 / 12 * holdingPeriod;
                const holdingCosts = (insurance + utilities + hoa + otherHolding) * holdingPeriod + propertyTax;
                
                const sellingCosts = arv * sellingClosingPercent / 100;
                
                // Recalculate max price with these costs
                maxPrice = arv * (1 - profitPercent/100) - totalRepairCost * (1 + contingencyPercent/100) - holdingCosts - sellingCosts - purchaseClosingCost - titleInsurance - inspection - appraisal - survey - otherPurchase;
                
                // If financed, account for loan costs
                if (purchaseMethod === 'loan') {
                    const loanAmount = maxPrice * loanPercent / 100;
                    const pointsCost = loanAmount * loanPoints / 100;
                    const monthlyInterest = loanAmount * (interestRate / 100 / 12);
                    const totalInterest = monthlyInterest * loanTerm;
                    
                    maxPrice -= (pointsCost + originationFee + totalInterest);
                }
            }
            
            // Ensure max price is not negative
            maxPrice = Math.max(0, maxPrice);
            
            // Now calculate all costs with this max price
            const purchaseClosingCost = maxPrice * purchaseClosingPercent / 100;
            const propertyTax = maxPrice * taxRate / 100 / 12 * holdingPeriod;
            const holdingCosts = (insurance + utilities + hoa + otherHolding) * holdingPeriod + propertyTax;
            const sellingCosts = arv * sellingClosingPercent / 100;
            const contingencyCost = totalRepairCost * contingencyPercent / 100;
            const totalRepairWithContingency = totalRepairCost + contingencyCost;
            
            // Loan costs if applicable
            let loanAmount = 0;
            let pointsCost = 0;
            let totalInterest = 0;
            let capitalNeeded = maxPrice + purchaseClosingCost + titleInsurance + inspection + appraisal + survey + otherPurchase + totalRepairWithContingency + holdingCosts;
            
            if (purchaseMethod === 'loan') {
                loanAmount = maxPrice * loanPercent / 100;
                pointsCost = loanAmount * loanPoints / 100;
                const monthlyInterest = loanAmount * (interestRate / 100 / 12);
                totalInterest = monthlyInterest * loanTerm;
                
                capitalNeeded = (maxPrice - loanAmount) + purchaseClosingCost + titleInsurance + inspection + appraisal + survey + otherPurchase + totalRepairWithContingency + holdingCosts + pointsCost + originationFee + totalInterest;
            }
            
            const totalProjectCost = capitalNeeded + sellingCosts;
            const estimatedProfit = arv - totalProjectCost;
            const roi = (estimatedProfit / capitalNeeded) * 100;
            const profitPerMonth = estimatedProfit / holdingPeriod;
            
            // Update the UI with results
            document.getElementById('max-price').textContent = `$${maxPrice.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('total-cost').textContent = `$${totalProjectCost.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('estimated-profit').textContent = `$${estimatedProfit.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('roi').textContent = `${roi.toFixed(1)}%`;
            
            // Update breakdown sections
            document.getElementById('purchase-price-breakdown').textContent = `$${maxPrice.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('purchase-costs-breakdown').textContent = `$${(purchaseClosingCost + titleInsurance + inspection + appraisal + survey + otherPurchase).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('loan-costs-breakdown').textContent = purchaseMethod === 'loan' ? `$${(pointsCost + originationFee + totalInterest).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}` : '$0';
            document.getElementById('repair-costs-breakdown').textContent = `$${totalRepairWithContingency.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('holding-costs-breakdown').textContent = `$${holdingCosts.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('selling-costs-breakdown').textContent = `$${sellingCosts.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('total-cost-breakdown').textContent = `$${totalProjectCost.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            
            document.getElementById('arv-breakdown').textContent = `$${arv.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('total-investment').textContent = `$${capitalNeeded.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('profit-percent-breakdown').textContent = `${profitPercent}%`;
            document.getElementById('profit-per-month').textContent = `$${profitPerMonth.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('capital-needed').textContent = `$${capitalNeeded.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('net-profit').textContent = `$${estimatedProfit.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            
            // Update detailed calculations table
            const detailedCalc = document.getElementById('detailed-calc');
            detailedCalc.innerHTML = '';
            
            const addRow = (item, amount, notes = '') => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${amount}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${notes}</td>
                `;
                detailedCalc.appendChild(row);
            };
            
            addRow('After Repair Value (ARV)', `$${arv.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, 'Estimated value after repairs');
            addRow('Desired Profit Percentage', `${profitPercent}%`, 'Your target profit margin');
            addRow('Maximum Purchase Price', `$${maxPrice.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, 'Calculated based on your inputs');
            
            if (purchaseMethod === 'loan') {
                addRow('Loan Amount', `$${loanAmount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} (${loanPercent}%)`, 'Financed portion of purchase');
                addRow('Loan Points', `$${pointsCost.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, `${loanPoints}% of loan amount`);
                addRow('Loan Origination Fee', `$${originationFee.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, 'Flat fee for loan processing');
                addRow('Total Interest', `$${totalInterest.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, `${interestRate}% over ${loanTerm} months`);
            }
            
            addRow('Purchase Closing Costs', `$${purchaseClosingCost.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, `${purchaseClosingPercent}% of purchase price`);
            addRow('Title Insurance', `$${titleInsurance.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, 'One-time fee');
            addRow('Inspection & Appraisal', `$${(inspection + appraisal).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, 'Required for purchase');
            
            repairItems.forEach(item => {
                addRow(`Repair: ${item.name}`, `$${item.cost.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, '');
            });
            
            addRow('Repair Contingency', `$${contingencyCost.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, `${contingencyPercent}% of repair costs`);
            addRow('Property Taxes', `$${propertyTax.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, `${taxRate}% annual rate for ${holdingPeriod} months`);
            addRow('Insurance & Utilities', `$${(insurance + utilities).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, `Monthly costs for ${holdingPeriod} months`);
            addRow('Selling Closing Costs', `$${sellingCosts.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, `${sellingClosingPercent}% of selling price`);
            
            addRow('Total Project Cost', `$${totalProjectCost.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, 'Sum of all costs');
            addRow('Estimated Profit', `$${estimatedProfit.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, `$${arv.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} - $${totalProjectCost.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`);
            addRow('Return on Investment (ROI)', `${roi.toFixed(1)}%`, `Profit as percentage of capital invested`);
            addRow('Profit per Month', `$${profitPerMonth.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`, `Over ${holdingPeriod} months`);
            
            // Switch to results tab
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.getElementById('results').classList.add('active');
            document.querySelector('[data-tab="results"]').classList.add('active');
        }
        
        // Initialize with some sample repair items
        const sampleRepairs = [
            { name: 'Paint Interior', cost: 2500 },
            { name: 'Kitchen Remodel', cost: 8000 },
            { name: 'Bathroom Update', cost: 5000 },
            { name: 'Flooring', cost: 4500 }
        ];
        
        sampleRepairs.forEach(repair => {
            const repairItem = document.createElement('div');
            repairItem.className = 'repair-item flex justify-between items-center p-3 border-b last:border-b-0';
            repairItem.innerHTML = `
                <span>${repair.name}</span>
                <div class="flex items-center">
                    <span class="text-gray-700 mr-4 editable-cost">$${repair.cost.toFixed(2)}</span>
                    <button class="delete-repair text-red-500 hover:text-red-700">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            repairList.appendChild(repairItem);
            
            // Add delete functionality
            repairItem.querySelector('.delete-repair').addEventListener('click', () => {
                repairItem.remove();
                updateRepairCostsTotal();
            });
            
            // Make cost editable
            const costElement = repairItem.querySelector('.editable-cost');
            costElement.addEventListener('click', () => {
                makeCostEditable(costElement);
            });
        });
        
        // Initialize totals
        updatePurchaseCostsTotal();
        updateHoldingCostsTotal();
        updateRepairCostsTotal();
    </script>
</body>
</html>